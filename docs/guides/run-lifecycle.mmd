sequenceDiagram
  autonumber
  participant S as Scheduler (cron/launchd/systemd/daemon)
  participant NS as nightshift run
  participant C as Config/Logging
  participant DB as SQLite State
  participant B as Budget Manager
  participant P as Provider Selector
  participant O as Orchestrator
  participant R as Reports

  S->>NS: Start run
  NS->>C: Load config + init logging
  NS->>DB: Open DB + load state
  NS->>B: Calculate allowance(s)
  NS->>P: Choose provider (preference + budget)
  NS->>O: Plan → Implement → Review
  O->>DB: Record task + project runs
  NS->>R: Save run report + daily summary
  NS-->>S: Exit
